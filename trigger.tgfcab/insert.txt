	
	
	DECLARE @SEQUENCIA_SAI INT
	DECLARE @SEQUENNCIA_ENTD INT
	DECLARE @QTD_ATD INT
	DECLARE @STATUSNOTA CHAR
	DECLARE @CHAVENFEREF CHAR(80)
	DECLARE @NUNOTA_ENTRADA INT
	DECLARE @PROD_SAI INT
		
	IF(@TIPMOV ='V')
	BEGIN
		IF (@CODTIPOPER = 1363)
		BEGIN
			IF EXISTS(SELECT TOP 1 NUNOTAORIG FROM TGFVAR WHERE NUNOTA = @NUNOTA)
			BEGIN
				DELETE FROM TGFVAR WHERE NUNOTA = @NUNOTA 
				SET @PROD_SAI = (SELECT TOP 1 CODPROD FROM TGFITE WHERE NUNOTA = @NUNOTA)
				SET @SEQUENCIA_SAI = (SELECT CODPROD FROM TGFITE WHERE NUNOTA = @NUNOTA AND CODPROD = @PROD_SAI)
				SET @QTD_ATD = (SELECT QTDNEG FROM TGFITE WHERE NUNOTA = @NUNOTA AND CODPROD = @PROD_SAI)
				SET @STATUSNOTA = (SELECT QTDNEG FROM TGFITE WHERE NUNOTA = @NUNOTA AND CODPROD = @PROD_SAI)

				IF EXISTS (SELECT NUNOTA FROM TGFCAB WHERE CHAVENFE = @CHAVENFEREF)
				BEGIN
					SET @NUNOTA_ENTRADA = (SELECT NUNOTA FROM TGFCAB WHERE CHAVENFE = @CHAVENFEREF)
					SET @SEQUENNCIA_ENTD = (SELECT QTDNEG FROM TGFITE WHERE NUNOTA = @NUNOTA_ENTRADA AND CODPROD = @PROD_SAI)
		
					INSERT INTO TGFVAR(NUNOTA,SEQUENCIA,NUNOTAORIG,SEQUENCIAORIG,QTDATENDIDA,STATUSNOTA)
					VALUES(@NUNOTA, @SEQUENCIA_SAI,@NUNOTA_ENTRADA,@SEQUENNCIA_ENTD,@QTD_ATD,@STATUSNOTA)
				END
			END
		END
	END